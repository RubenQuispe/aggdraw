language: python
env:
    global:
        # Set defaults to avoid repeating in most cases
        - PYTHON_VERSION=$TRAVIS_PYTHON_VERSION
        - NUMPY_VERSION=stable
        - MAIN_CMD='python setup.py'
        - CONDA_DEPENDENCIES='sphinx pillow coveralls coverage'
        - SETUP_XVFB=False
        - EVENT_TYPE='push pull_request'
        - SETUP_CMD='test'
        - CONDA_CHANNELS='conda-forge'
matrix:
    include:
    - os: linux
      sudo: required
      python: 2.7
      env: USE_FREETYPE=false
    - os: linux
      sudo: required
      python: 2.7
      env: USE_FREETYPE=true
    - os: linux
      sudo: required
      python: 3.4
      env: USE_FREETYPE=false
    - os: linux
      sudo: required
      python: 3.4
      env: USE_FREETYPE=true
    - os: linux
      sudo: required
      python: 3.5
      env: USE_FREETYPE=false
    - os: linux
      sudo: required
      python: 3.5
      env: USE_FREETYPE=true
    - os: linux
      sudo: required
      python: 3.6
      env: USE_FREETYPE=false
    - os: linux
      sudo: required
      python: 3.6
      env: USE_FREETYPE=true
    - os: osx
      language: generic
      env: USE_FREETYPE=false USE_PYTHON=2
    - os: osx
      language: generic
      env: USE_FREETYPE=true USE_PYTHON=2
    - os: osx
      language: generic
      env: USE_FREETYPE=false USE_PYTHON=3
    - os: osx
      language: generic
      env: USE_FREETYPE=true USE_PYTHON=3
install:
    - git clone --depth 1 git://github.com/astropy/ci-helpers.git
    - if [[ "USE_FREETYPE" == "true" ]]; then
          CONDA_DEPENDENCIES="$CONDA_DEPENDENCIES freetype";
      fi
    - source ci-helpers/travis/setup_conda.sh
script:
    - pip install -e .
    - python selftest.py
deploy:
  provider: pypi
  user: dhoese
  password:
    secure: CYnfdweDHxSlPfks5YDZp9w4i5q4m/iUbIRrt37oHWhWVpnHa19yhk4BOBig5dAVJ5L/nYI/qz5bdE7NNubaXNnJTszhgK6RNRKg0LD80zliJxtCBXPnj8fvCgRKeQieiOurjyy4t0lEfeIVhEaEut9o3CuJXpONh9Zf8oL698Y=
  on:
    tags: true
    repo: pytroll/aggdraw
    python: 3.6
    os: linux
    condition: "$USE_FREETYPE == true"
    distributions: sdist
